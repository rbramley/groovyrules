<html>
  <head>
    <title>
      GroovyRules
    </title>
  </head>
  <body>
<!--
    <table>
      <tr>
	<td valign="top"><img src="images/icon.gif"></td>
	<td valign="top">
          <h1>GroovyRules</h1>
	</td>
      </tr>
    </table>
-->

    <blockquote>
      <!-- project info start -->
      <ul>
        <li><b>Project Name:</b> GroovyRules</li>
        <!-- Latest Release: e.g. 1.0 -->
        <li><b>Latest Release:</b> 1.0 RC1</li>
        <!-- Status of best release: Planning, Pre-Alpha, Alpha, Beta, Production -->
        <li><b>Latest Release Status:</b> Release Candidate</li>
        <!-- Project Type: Web Service, Tool, Component, or add your own -->
        <li><b>Project Type:</b> Rule Engine</li>
      </ul>
      <!-- project info end -->
      <p>
			GroovyRules is a very lightweight 
			<a href="http://www.jcp.org/en/jsr/detail?id=94">JSR-94</a> 
			rule engine implementation that allows rules to be defined 
			using the <a href="http://groovy.codehaus.org">Groovy</a>
			scripting language.
	  </p>
	  <p>
			Many Java projects benefit from the use of a rule engine - 
			providing the ability to take business rules out of the core 
			codebase, defined in a consistent manner, and changed without 
			a recompile of the application. However, a typical rule engine is a fairly 
			complex piece of software, and introducing one to your project 
			may have a significant overhead during development. One of the 
			goals behind GroovyRules is that it should impose little on the 
			user - the project will meet the goals of many projects, but does 
			not attempt to provide all the functionality of a larger commercial 
			or open source rule engine. Since your code uses GroovyRules 
			through the standard JSR-94 rule engine API, changing between 
			it and another rule engine should be reasonably straightforward 
			(with only the rule definitions themselves needing to be rewritten),
			if it should prove necessary at a later date.
		</p>
		<p>
			GroovyRules allows rules to be redefined at runtime, and your 
			application will automatically work to the new definitions. To achieve 
			this, each rule is defined in its own small file, using standard Groovy
			syntax. Rules are bound together into <i>rule execution sets</i>, or 
			sets of rules that execute in a specific situation, using an XML 
			descriptor file.
		</p>
		<p>
			GroovyRules is <i>not</i> intended to compete with heavy-duty
			commercial or open source rule engines, but it provides a way to
			meet the requirements of many projects with little overhead in either
			development effort or architecture.
		</p>
    </blockquote>

    <a name="contents">
    <h3>Contents</h3>
    </a>
    <blockquote>
      <dl>
	<!--<dd><a href="#screenshot">Screenshot</a></dd>-->
	<dd><a href="#download">Download and Installation</a></dd>
	<dd><a href="#background">Background</a></dd>
	<dd><a href="#features">Features</a></dd>
	<dd><a href="#building">Building From Source</a></dd>
	<dd><a href="#usage">Usage Instructions</a></dd>
	<!--<dd><a href="#tck">Running the TCK</a></dd>-->
	<dd><a href="#support">Support</a></dd>
	<dd><a href="#participate">Participation</a></dd>
	<dd><a href="#revision">Revision History</a></dd>
      </dl>
    </blockquote>

<!--
    <a name="screenshot">
    <h3>Screenshot</h3>
    <blockquote>
      <img src="images/screenshot.gif" alt="Screenshot" />
    </blockquote>
    </a>
-->

    <a name="download">
    <h3>Download and Installation</h3>
    </a>
    <blockquote>
    	<p>
      	The latest release of GroovyRules is available from the 
        <a href="servlets/ProjectDocumentList">Files Section</a> of this
        site. The following jars need to be added to your project's classpath:
        </p>
        <ul>
        	<li>groovyrules.jar - This contains the GroovyRules implementation.</li>
        	<li>jsr94.jar - This contains the JSR-94 APIs, available from 
        	<a href="http://jcp.org/aboutJava/communityprocess/final/jsr094/index.html">this site</a>.</li>
        	<li>groovy-all-1.0.jar - This contains the Groovy language
        	implementation, and all required 
        	libraries - it can be substituted with another version of Groovy if you 
        	prefer, available from 
        	<a href="http://groovy.codehaus.org">this site</a>. Please ensure
        	all required libraries are present if you do not use a <i>groovy-all-*</i>
        	jar.</li>
        </ul>
    </blockquote>

    <a name="background">
    <h3>Background</h3>
    </a>
    <blockquote>
    	<p>
      GroovyRules as an idea was seeded in work done on a simple JSR94
      implementation (created for a proof-of-concept application,
      whilst a commercial rule engine was being decided upon). 
      This early approach was very simple, with the team implementing
      only exactly what they required, but proved adequate to implement
      a variety of real-world rules.
      </p>
      <p>
      Rob Newsome became involved in the 
      <a href="http://www.jcp.org/en/jsr/detail?id=241">Groovy language JSR</a>, 
      and thought the language was quite a neat (and powerful) way 
      of specifying rule definitions. GroovyRules was born as an attempt 
      at a simple but flexible implementation of the rule engine API, building
      on the earlier work done by colleagues.     
      </p>
      <p>
      After a demonstration at 
      <a href="http://java.sun.com/javaone/">JavaOne 2005</a> (as part of Rob's session on the 
      application of Groovy within large commercial projects), a number of the
      audience expressed an interest using GroovyRules. Accordingly, the
      project was moved to Java.net to allow others to work with it.
      </p>
    </blockquote>

    <a name="features">
    <h3>Features</h3>
    </a>
    <blockquote>
	  GroovyRules includes the following features:
      <ul>
		<li>A very simple, lightweight 
			<a href="http://www.jcp.org/en/jsr/detail?id=94">JSR-94 
			Rule Engine API</a> 
			implementation.</li>
		<li>Supports the specification of rules using the full power
			of the <a href="http://groovy.codehaus.org">Groovy</a> 
			scripting language.</li>
		<li>Allows rule definitions to be replaced and altered at runtime, 
			without recompilation, server restart or redeployment.</li>
		<li>All rules are defined as simple <code>.groovyrule</code> script
			files, which are precompiled and cached for performance (until 
			changed).</li>
		<li>Rules are combined to form <i>rule execution sets</i> using 
			XML descriptors, tailored to be run in specific situations.</li>
		<li>Supports both <i>stateless</i> and <i>stateful</i> rule
			sessions.</li>
		<li>Optionally allows (via the <i>direct</i> rule service provider) 
			rules to be passed in programatically at runtime, as Groovy 
			fragments.</li>
		<li>Little code stands between your application and your rules - so
			any issues in use should be easily diagnosed and fixed.</li>
      </ul>
    </blockquote>
    
    <a name="building">
    <h3>Build Instructions</h3>
    </a>
    <blockquote>
    To build GroovyRules, follow these steps:
    <ol>
      <li>
        Download and install <code>ant</code> 1.5.1 or greater from
        <a href="http://ant.apache.org" target="_blank">
        http://ant.apache.org/</a>.
      </li>
      <li>
        Check out the <code>groovyrules</code> source code from java.net.  You
        can find instructions for doing so here:
        <a href="http://groovyrules.dev.java.net/source/browse/groovyrules/"
           target="_blank">
        http://groovyrules.dev.java.net/source/browse/groovyrules/</a>.
      </li>
      <li>
        Change your directory to <code>groovyrules</code>.<!-- and copy
        the <code>build.properties.sample</code> template
        to <code>build.properties</code>.-->
      </li>
      <!--<li>
        Follow the instructions in <code>build.properties</code> to configure
        for your environment.
      </li>-->
      <li>
        Run '<code>ant dist</code>'.  A <code>dist</code> directory will be
        created containing <code>groovyrules.jar</code>, a javadoc API documentation
        zip, and <code>groovyrules-dist.zip</code> containing all jars that 
        need to be added to your classpath.
      </li>
      <li>
      	See the instructions above for how to add GroovyRules to your project,
      	and the instructions below for how to use GroovyRules.
      </li>
    </ol>
    </blockquote>

    <a name="usage">
    <h3>Usage Instructions</h3>
    </a>
    <blockquote>
    <p>
    To use GroovyRules, first, <a href="#build">build the application</a> or
    <a href="#download">download</a> a precompiled binary.
    Then, follow the instructions below.
    </p>
    <p>
    The example given here is a modification of the simple invoice processing
    example given in the <a href="http://www.jcp.org/aboutJava/communityprocess/final/jsr094/">
    JSR-94 Reference Implementation</a>. This defines the concepts of 
    Customer and Invoice. The rules used here are:
    </p>
    <ol>
    	<li>If an invoice is "unpaid" and for more than $500, reject it as 
    		"excessive".</li>
		<li>If an invoice is still "unpaid", mark it as "paid" and decrease
			the customer's account balance by the invoice amount.</li>
	</ol>
		
    <h4>Defining Rules</h4>
    <p>
	A rule set consists of a <i>rule execution set descriptor</i> and one or
	more <i>rule definition</i> instances.
	</p>
	<p>
	First, let us define the <i>rule execution set descriptor</i> - an XML file, 
	which we will call <i>invoicerules.xml</i>:
	</p>
	<pre>
	&lt;ruleexecutionset&gt;
		&lt;name&gt;Invoice Handling Rule Set&lt;/name&gt;
		&lt;description&gt;Handles invoices for customers&lt;/description&gt;
		&lt;ruleroot&gt;/org/groovyrules/test&lt;/ruleroot&gt;
		&lt;rules&gt;
			&lt;rule&gt;excessive_invoice.groovyrule&lt;/rule&gt;
			&lt;rule&gt;pay_invoice.groovyrule&lt;/rule&gt;
		&lt;/rules&gt;
	&lt;/ruleexecutionset&gt;
	</pre>
	<p>
	This descriptor defines a single rule execution set, provides a name
	and description for it, and then identifies two rules that are to be run
	as part of this rule set. These rules are defined as script files, which 
	must reside under a common directory (the <i>rule root</i>).
	</p>
	<p>
	Next, we define the rules themselves. The first rule, to govern the 
	behaviour of excessive invoices, is defined using the following Groovy
	code, in a file referenced above as <i>excessive_invoice.groovyrule</i>:
	</p>
	<pre>
	customer = data.getFirstObjectOfType(org.groovyrules.test.Customer);
	
	data.getObjectsOfType(org.groovyrules.test.Invoice).each() { invoice |
		if(invoice.status == "unpaid" && invoice.amount &gt; 500 ) { 
			invoice.status = "excessive"; 
		}
	}
	</pre>
	<p>
	This simple example here assumes that the list of data passed in (as the
	<code>data</code> variable, available automatically in the script) contains
	one instance of a Customer and possibly several Invoice instances. The 
	simple Groovy fragment (which demonstrates using Groovy's each() method on 
	the list, passing in a closure) checks if the invoice amount is more than $500. Note
	that the properties on the JavaBeans are accessed in Groovy as if they were
	fields - Groovy will ensure the getXXX() methods are called correctly.
	</p>
	<p>
	The second rule actually pays the invoice. It assumes the first rule will have
	run if it needed to. It is defined as the file <i>pay_invoice.groovyrule</i>:
	</p>
	<pre>
	customer = data.getFirstObjectOfType(org.groovyrules.test.Customer);
	
	data.getObjectsOfType(org.groovyrules.test.Invoice).each() { invoice |
		if(invoice.status == "unpaid") { 
			customer.creditLimit = 
				customer.creditLimit - invoice.amount;
			invoice.status = "paid";
		}
	}
	</pre>
	<p>
	Again this rule extracts the Customer and Invoice instances, and runs
	some simple logic against them. This time, however, we demonstrate 
	retrieving the objects based on their type, rather than their position 
	in the list.
	</p>
	<p>
	For more information about Groovy syntax, see the <a target="_blank" 
	href="http://groovy.codehaus.org/">Groovy website</a>.
	</p>
	
    <h4>Calling Rules</h4>
   <p>
   Now we have defined our rule set, we can call it using the standard
   JSR-94 API. A full description of this API is available elsewhere, but
   an example showing how to call the above rules, passing in a 
   Customer and Invoice, is shown in
   <a href="source/browse/groovyrules/groovyrules/test/org/groovyrules/test/BasicRuleTest.java?view=markup" target="_blank">this test case</a>. This code
   is based very much on the example in the JSR-94 Reference
   Implementation, which can be run with only a minor modification to 
   change the implementation class and the rule execution set configuration
   file. The key parts of the calling code are shown here:
   </p>
   <pre>
	<font color="green">// Load the rule service provider of the implementation.
	// Loading this class will automatically register this
	// provider with the provider manager.</font>
	Class.forName("org.groovyrules.core.RuleServiceProviderImpl");
	
	<font color="green">// Get an input stream for our rule set definition file</font>
	InputStream inStream = getClass().getResourceAsStream(
		"/org/groovyrules/test/invoicerules.xml");

	<font color="green">// Boilerplate code to create a rule execution set</font>
	<font color="green">// from the InputStream we have</font>
	RuleServiceProvider serviceProvider = 
		RuleServiceProviderManager.getRuleServiceProvider(
			"org.groovyrules.core.RuleServiceProviderImpl");
	RuleAdministrator ruleAdministrator = 
		serviceProvider.getRuleAdministrator();
	LocalRuleExecutionSetProvider provider = 
		ruleAdministrator.getLocalRuleExecutionSetProvider(null);
	RuleExecutionSet res1 = 
		provider.createRuleExecutionSet(inStream, null);

	<font color="green">// Register the RuleExecutionSet</font>
	<font color="green">// Here we simply use the set's name as its URI</font>
	String uri = res1.getName();
	ruleAdministrator.registerRuleExecutionSet(uri, res1, null);

	<font color="green">// Get a handle on the RuleRuntime</font>
	RuleRuntime ruleRuntime = serviceProvider.getRuleRuntime();

	<font color="green">// Create a StatelessRuleSession</font>
	StatelessRuleSession statelessRuleSession = 
		(StatelessRuleSession) ruleRuntime.createRuleSession(uri,
			new HashMap(), RuleRuntime.STATELESS_SESSION_TYPE);

	<font color="green">// Execute the rules</font>
	List results = statelessRuleSession.executeRules(input);
   </pre>
   <p>
   While this may look more complex than simply calling a Groovy script
   engine directly, it does provide a standards-compliant way to access your
   rules, and will greatly help if you decide to change your rule engine at a
   later date.
   </p>
   <p>
   Note that the JSR-94 API takes a List of data as an argument and returns
   a List as results - this allows you the flexibility to put whatever you may 
   need to inside this List.
   </p>
   
   </blockquote>

<!--
    <a name="tck">
    <h3>Running the TCK</h3>
    </a>
    <blockquote>
    To run the JSR-94 TCK against GroovyRules, follow these steps:
    <ol>
      <li>
        Ensure you can build GroovyRules from source, as described 
        <a href="#build">above</a>.
      </li>
	  <li>[Further instructions required here]</li>
    </ol>
    </blockquote>
-->

    <a name="support">
    <h3>Support</h3>
    </a>
    <blockquote>
      <p>
      GroovyRules is a community-supported open-source product.  You can find
      support by subscribing to the various 
      <a href="servlets/ProjectMailingListList">mailing lists</a> offered
      in this java.net project.
      </p>
    </blockquote>

    <a name="participate">
    <h3>Participation</h3>
    </a>
    <blockquote>
      <p>
      The project is interested in hearing from anyone who would like
      to help, whether it be working on the code or simply providing 
      useful feedback on real-world usage. A good place to start is by joining
      one of the <a href="servlets/ProjectMailingListList">mailing lists</a>, 
      and letting everyone know that you'd like to participate.
      </p>
    </blockquote>

    <a name="revision">
    <h3>Revision History</h3>
    </a>
    <blockquote>
      <ul>
		<li><a href="/servlets/ProjectDocumentList?folderID=3837&expandFolder=3837&folderID=3837">Version Beta 1 - [02/08/2005]</a>
		  <ul>
		    <li>Initial beta open source release to java.net.</li>
	  	    <li>Core Stateless JSR-94 APIs implemented.</li>
		  </ul>
	    </li>
		<li><a href="/servlets/ProjectDocumentList?folderID=4806&expandFolder=4806&folderID=4806">Version Beta 2 - [08/02/2006]</a>
		  <ul>
		  	<li>Further Stateless JSR-94 API methods implemented.</li>
	  	    <li>JSR-94 TCK tests integrated into Ant build. Passes all TCK tests 
	  	    apart from those for Stateful rule sessions (which are not yet implemented - 4 test cases currently fail).</li>
		  	<li>Includes additions by Steve Jones to allow rules to be passed directly 
		  	from code, in addition to being defined in files (see the 
		  	<a href="source/browse/groovyrules/groovyrules/test/org/groovyrules/test/DirectRulesTest.java?view=markup" target="_blank"><tt>DirectRuleTest</tt></a>
		  	test case).</li>
	  	    <li>Internal refactoring, to split out file-based and direct rule implementation 
	  	    code from the core. This should be transparent to the user.</li>
	  	    <li>Creation of a new RuleServiceProvider implementation: <tt>org.groovyrules.directrules.DirectRuleServiceProviderImpl</tt></li>
		  </ul>
	    </li>
	    <li><a href="/servlets/ProjectDocumentList?folderID=4821&expandFolder=4821&folderID=4821">Version Beta 3 - [13/02/2006]</a>
		  <ul>
		  	<li>Stateful JSR-94 API methods implemented.</li>
	  	    <li>Passes all JSR-94 TCK test cases for standard file-based RuleServiceProvider. GroovyRules is now a fully JSR-94 compliant rule engine.</li>
		  	<li><tt>RuleData</tt> class added to keep track of data provided to rules and stateful sessions. An instance of this class is the '<tt>data</tt>' 
		  	property exposed to rules - it implements the <tt>java.util.List</tt> interface, and has convenience methods to retrieve objects of particular types.</li>
		  	<li>Updated example and test rule definitions to demonstate the convenience methods on <tt>RuleData</tt> - 
		  	see <a href="source/browse/groovyrules/groovyrules/test/org/groovyrules/test/rule1.groovyrule?view=markup" target="_blank">test rule 1</a>, 
		  	<a href="source/browse/groovyrules/groovyrules/tck/tck_res_1_rule_1.groovyrule?view=markup" target="_blank">tck rule</a>.</li> 
		  </ul>
	    </li>
	    <li><a href="/servlets/ProjectDocumentList?folderID=7045">Version 1.0 RC1 - [09/03/2007]</a>
		  <ul>
			<li>Release candidate for 1.0.</li>
		  	<li>Upgraded Groovy to 1.0.</li>
	  	    <li>Fix for <a href="/issues/show_bug.cgi?id=1">groovyrules-1</a>: Default ObjectFilter for RuleExecutionSets is now applied.</li> 
		  </ul>
	    </li>	    
	    
	    <!--<li>[TO DO]</li>-->
	    
      </ul>
    </blockquote>
    <hr>
    <small>
    <i>Part of the <a href="http://java-enterprise.dev.java.net/">
    Java Enterprise Community</a>.</i></small>
  </body>
</html>
